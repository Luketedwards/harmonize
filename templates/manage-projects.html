{% extends 'base.html'%}
{% block content %}
<h3 class="center-align">Manage Project: {{thisProject.projectTitle|title}}</h3>

{% set noOfFiles = thisProject.projectFiles|length%}
<div id="create-project-panel" class=" card-panel">
    <form class="col s12 m8 offset-m2" method="POST" action="#!">
        <div class="row">
            <div id="project-username-div" class="row">
                
                    <input id="project-username" name="project-username" value="{{user}}" type="text" minlength="5"
                        maxlength="300" >
                    <label for="project-username">username</label>
            </div>
        </div>    
            <div class="row">
                <div class="input-field col s12">
                    
                    <input id="project-title" name="project-title" value="{{thisProject.projectTitle}}" type="text" minlength="5"
                        maxlength="300" required>
                    <label for="project-title">Project Title</label>
                </div>
            </div>
            <div class="input-field col s12">
                <div class="input-field col s12">
                    
                    <input id="project-description" name="project-description" value="{{thisProject.projectDescription}}" type="text" minlength="5"
                        maxlength="3000" required></input>
                    <label for="project-description">Project Description</label>
                </div>
        
                <div class="row">
                    <div class="input-field col l6 m6 s12">
                      <input id="city" name="city" type="text" value="{{thisProject.city}}" class="validate">
                      <label for="city">City</label>
                    </div>
                    <div class="input-field col l6 m6 s12">
                        <input id="email" value="{{user.email}}" name="email" value="{{thisProject.email}}" type="email" class="validate">
                        <label for="email">Contact Email</label>
                    </div>
                </div>
            </div>    
            <div class="input-field col s12">
                <select id="instruments" name="instruments" required multiple>
                  <option value="Guitar">Guitar</option>
                  <option value="Bass Guitar">Bass Guitar</option>
                  <option value="Mandolin">Mandolin</option>
                  <option value="Violin">Violin</option>
                  <option value="Viola">Viola</option>
                  <option value="Cello">Cello</option>
                  <option value="Trumpet">Trumpet</option>
                  <option value="Trombone">Trombone</option>
                  <option value="French Horn">French Horn</option>
                  <option value="Euphonium">Euphonium</option>
                  <option value="Saxophone">Saxophone</option>
                  <option value="Clarinet">Clarinet</option>
                  <option value="Flute">Flute</option>
                  <option value="Drums">Drums</option>
                  
                </select>
                
                <label for="instruments">Instruments Needed</label>
                    
              </div>
              <div class="input-field col s12">
                <select id="genres" name="genres" required multiple>
                  <option value="Rock">Rock</option>
                  <option value="Pop">Pop</option>
                  <option value="Classical">Classical</option>
                  <option value="Jazz">Jazz</option>
                  <option value="Metal">Metal</option>
                  <option value="Blues">Blues</option>
                  <option value="Bluegrass">Bluegrass</option>
                  <option value="Folk">Folk</option>
                  <option value="EDM">EDM</option>
                  <option value="Celtic">Celtic</option>
                  <option value="World">World</option>
                  
                </select>
                
                <label for="genres" >Genres Needed</label>
                    
                  
              </div>
            <div id="manage-project-btn" class="row">
                <button type="submit" class=" btn-large  text-shadow">
                    Make Changes 
                </button>
                <a id="projectDelete" href="#modal2" class="btn-large red modal-trigger">
                    Delete Project
                </a>
            
            </div>
    </form>    
    <div class="row">
        <div class="col s12">
            <p class="center-align">
                Changed your mind? 
                <a href="{{ url_for('profile', username=session['user']) }}" class="light-blue-text text-darken-4">Back to profile</a>
            </p>
        </div>
    </div>
    </div>
    <div id="project-members-panel" class="card-panel">
            
            
            <h3 class="center">Project Members</h3>
            {% if members|length == 0%}
                    <h5 class="center card-panel">No current members.</h5>
                {%else%}
                {% for member in members%}   
                <div class="yellow-bg card-panel white-text">
                    <a class="white-text" href="{{url_for('other_profile', usernameOther=member.memberUsername )}}"><h4>{{member.memberUsername}}</h4></a>
                    
                    <span>{{member.memberInstrument}}</span>
                    <a id="remove-member-btn" href="{{url_for('remove_member', thisProject=thisProject._id, member=member.memberUsername, thisProjectTitle=thisProject.projectTitle)}}" class="btn red right">Remove</a>
                   
                </div>
                {%endfor%}
            {%endif%}  
            <h3 class="center">Project Applications</h3>
            {% if applications|length == 0%}
                    <h5 class="center card-panel red lighten-2 white-text border">No current applications.</h5>
                {%else%}
                {% for apply in applications%}   
                <div class="card-panel center-align">
                    <a href="{{url_for('other_profile', usernameOther=apply.applicantUsername )}}"><h4>{{apply.applicantUsername}}</h4></a>
                    <div class="row s12">
                    <div>
                        <h5>Project Message</h5>
                        <p>{{apply.projectMessage}}</p>
                    </div>
                    <div>
                        <h5>Instrument applied for.</h5>
                        {% for instrument in apply.instruments%}
                        <p>{{instrument}}</p>
                        {%endfor%}
                    </div>    
                </div>
                    <a href="{{url_for('accept_application', applicant=apply.applicantUsername,applicantInstrument=apply.instruments[0], thisProject=thisProject._id, thisProjectTitle= thisProject.projectTitle)}}" class="waves-effect waves-light green btn">Accept</a>
                    <a id="application-denied-btn" href="{{url_for('deny_application', applicant=apply.applicantUsername, thisProject=thisProject._id,thisProjectTitle= thisProject.projectTitle)}}" class="waves-effect waves-light btn red">Deny</a>
                </div>
                {%endfor%}
            {%endif%}    
</div>         
</div>   

<div id="modal2" class="modal">
    <div class="modal-content center">
      <h4>Are you sure you want to delete this project?</h4>
      <p>Deleting the project is irreversible and will also delete all related project files and comments.</p>
    </div>
    <div class="row">
    <div class="modal-footer center">
        <div class="col s12 center" >
      <a href="{{url_for('delete_project',thisProjectId=thisProject._id, thisProjectTitle=thisProject.projectTitle, noOfFiles=noOfFiles)}}" class=" modal-close waves-effect waves-green btn-flat red white-text center">Delete</a>
      <a href="#!" class=" modal-close waves-effect waves-green btn-flat grey white-text center">Cancel</a>
      </div>
    </div>
</div>
  </div>
              
              
<script>
    var instrumentsArray = {{thisProject.instruments|safe}}
    var genreArray = {{thisProject.genres|safe}}
    var optionsToSelect = instrumentsArray
    var optionsToSelectGenre = genreArray
    var select = document.getElementById('instruments')
    var selectGenre = document.getElementById('genres')
    for ( var i = 0, l = select.options.length, o; i < l; i++ )
{
o = select.options[i];
if ( optionsToSelect.indexOf( o.text ) != -1 )
{
o.selected = true;
}
}

for ( var i = 0, l = selectGenre.options.length, o; i < l; i++ )
{
o = selectGenre.options[i];
if ( optionsToSelectGenre.indexOf( o.text ) != -1 )
{
o.selected = true;
}
}

</script>   
{%endblock%}
